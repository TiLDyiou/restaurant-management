<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="RestaurantManagementGUI.Views.Admin.QuanLyMonAnPage" 
             xmlns:models="clr-namespace:RestaurantManagementGUI.Models"
             xmlns:viewModels="clr-namespace:RestaurantManagementGUI.ViewModels"
             xmlns:converters="clr-namespace:RestaurantManagementGUI.Converters"
             Title="Quản Lý Món Ăn"
             BackgroundColor="#F5F7FA">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto, *">

        <Border Grid.Row="0" StrokeShape="RoundRectangle 10" BackgroundColor="White" Padding="15" Margin="10">
            <VerticalStackLayout Spacing="10">
                <Label Text="Thêm món ăn mới" FontAttributes="Bold" FontSize="18"/>

                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto, Auto" ColumnSpacing="10" RowSpacing="5">

                    <Entry Grid.Row="0" Grid.Column="0" Placeholder="Tên món ăn (vd: Phở bò)" 
                           Text="{Binding NewTenMA}" />

                    <Entry Grid.Row="0" Grid.Column="1" Placeholder="Giá (vd: 50000)" Keyboard="Numeric"
                           Text="{Binding NewDonGia}" />

                    <Entry Grid.Row="1" Grid.Column="0" Placeholder="Loại (vd: Món chính)" 
                           Text="{Binding NewLoai}" />

                    <Grid Grid.Row="1" Grid.Column="1" ColumnDefinitions="*, Auto" ColumnSpacing="5">
                        <Entry Grid.Column="0" Placeholder="Ảnh (Chèn link hoặc chọn file)" 
                               Text="{Binding NewHinhAnh}" />

                        <Button Grid.Column="1" Text="..." 
                                Command="{Binding PickImageCommand}"
                                HeightRequest="45" WidthRequest="50" VerticalOptions="Center" Padding="0"/>
                    </Grid>
                </Grid>

                <Button Text="THÊM MÓN MỚI" 
                        Command="{Binding AddDishCommand}"
                        BackgroundColor="{StaticResource PrimaryColor}" TextColor="White" FontAttributes="Bold" />
            </VerticalStackLayout>
        </Border>

        <ScrollView Grid.Row="1" Padding="10">
            <CollectionView ItemsSource="{Binding FoodItems}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:FoodModel">
                        <Border StrokeShape="RoundRectangle 10" Padding="10" Margin="0,5" BackgroundColor="White" Stroke="#E0E0E0">
                            <Grid ColumnDefinitions="Auto, *, Auto, Auto">
                                <Image Grid.Column="0" Source="{Binding ImageUrl}" HeightRequest="60" WidthRequest="60" Aspect="AspectFill" />

                                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Padding="10,0">
                                    <Label Text="{Binding Name}" FontAttributes="Bold" TextColor="Black" />
                                    <Label Text="{Binding Price, StringFormat='{0:N0} VNĐ'}" TextColor="Gray" />
                                    <Label Text="ĐANG ẨN (NGHỈ BÁN)" TextColor="Red" FontAttributes="Bold" 
                                           IsVisible="{Binding TrangThai, Converter={StaticResource InvertedBoolConverter}}" />
                                </VerticalStackLayout>

                                <Button Grid.Column="2" Text="Sửa"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FoodViewModel}}, Path=EditDishCommand}"
                                        CommandParameter="{Binding .}"
                                        BackgroundColor="#3B5998" TextColor="White"
                                        CornerRadius="5" HeightRequest="40" FontSize="12" Margin="5,0"/>

                                <Button Grid.Column="3" Text="Xóa"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FoodViewModel}}, Path=DeleteDishCommand}"
                                        CommandParameter="{Binding .}"
                                        BackgroundColor="#D32F2F" TextColor="White"
                                        CornerRadius="5" HeightRequest="40" FontSize="12"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </ScrollView>

        <ActivityIndicator Grid.RowSpan="2" IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" 
                           HorizontalOptions="Center" VerticalOptions="Center" Color="{StaticResource PrimaryColor}"/>
    </Grid>
</ContentPage>