<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:conv="clr-namespace:RestaurantManagementGUI.Converters"
             x:Class="RestaurantManagementGUI.UsersPage"
             BackgroundColor="#263238"
             Shell.NavBarIsVisible="True">

    <ContentPage.Resources>
        <Color x:Key="PrimaryColor">#263238</Color>
        <Color x:Key="AccentColor">#FFBD59</Color>
        <Color x:Key="LightBackground">#FAFAFA</Color>
        <Color x:Key="TextPrimary">#FFFFFF</Color>
        <Color x:Key="TextSecondary">#B0BEC5</Color>

        <conv:StatusColorConverter x:Key="StatusColorConverter"/>
        <conv:CanEditConverter x:Key="CanEditConverter"/>
        <conv:StatusButtonTextConverter x:Key="StatusButtonTextConverter"/>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="18">

            <Label Text="Danh sÃ¡ch nhÃ¢n viÃªn"
                   FontSize="22"
                   FontAttributes="Bold"
                   TextColor="{StaticResource AccentColor}"
                   HorizontalOptions="Center"/>

            <SearchBar x:Name="SearchBarUsers"
                       Placeholder="ðŸ” TÃ¬m kiáº¿m theo mÃ£ hoáº·c tÃªn nhÃ¢n viÃªn..."
                       PlaceholderColor="#B0BEC5"
                       TextColor="#FFFFFF"
                       BackgroundColor="#37474F"
                       HeightRequest="45"
                       FontSize="16"
                       Margin="0,5,0,10"
                       TextChanged="OnSearchTextChanged" />

            <Button Text="ThÃªm nhÃ¢n viÃªn"
                    BackgroundColor="{StaticResource AccentColor}"
                    TextColor="{StaticResource PrimaryColor}"
                    CornerRadius="12"
                    HeightRequest="50"
                    FontAttributes="Bold"
                    Clicked="OnAddUserClicked" />

            <CollectionView x:Name="UsersCollectionView"
                            SelectionMode="Single">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Stroke="{StaticResource AccentColor}"
                                StrokeThickness="1"
                               StrokeShape="RoundRectangle 14"
                               BackgroundColor="{StaticResource LightBackground}"
                               Padding="15"
                               Margin="0,8">
                            <Border.Shadow>
                                <Shadow Brush="#000" Offset="5,5" Radius="10" Opacity="0.1"/>
                            </Border.Shadow>
                            <VerticalStackLayout Spacing="6">

                                <Label Text="{Binding HoTen, StringFormat='Há» tÃªn: {0}'}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="#000000" />

                                <Label Text="{Binding MaNV, StringFormat='MÃ£ nhÃ¢n viÃªn: {0}'}"
                                       FontSize="14"
                                       TextColor="#333333" />

                                <Label Text="{Binding ChucVu, StringFormat='Chá»©c vá»¥: {0}'}"
                                       FontSize="14"
                                       TextColor="#444444" />

                                <Label Text="{Binding SDT, StringFormat='Sá»‘ Ä‘iá»‡n thoáº¡i: {0}'}"
                                       FontSize="14"
                                       TextColor="#444444" />

                                <Label Text="{Binding Email, StringFormat='Email: {0}'}"
                                       FontSize="14"
                                       TextColor="#444444" />

                                <Label Text="{Binding Quyen, StringFormat='Quyá»n: {0}'}"
                                       FontSize="14"
                                       TextColor="#757575" />

                                <Label Text="{Binding TrangThai, StringFormat='Tráº¡ng thÃ¡i: {0}'}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="{Binding TrangThai, Converter={StaticResource StatusColorConverter}}" />

                                <Label FontSize="14" FontAttributes="Bold">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label" Binding="{Binding Online}" Value="True">
                                            <Setter Property="Text" Value="â— Online (Äang hoáº¡t Ä‘á»™ng)" />
                                            <Setter Property="TextColor" Value="#4CAF50" />
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding Online}" Value="False">
                                            <Setter Property="Text" Value="â—‹ Offline" />
                                            <Setter Property="TextColor" Value="Gray" />
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>
                                <HorizontalStackLayout Spacing="10" Margin="0,10,0,0">

                                    <Button Text="Sá»­a"
                                            BackgroundColor="{StaticResource AccentColor}"
                                            TextColor="{StaticResource PrimaryColor}"
                                            CornerRadius="8"
                                            FontAttributes="Bold"
                                            Clicked="OnEditClicked"
                                            IsEnabled="{Binding TrangThai, Converter={StaticResource CanEditConverter}}"
                                            Padding="10,0"/>

                                    <Button Text="{Binding TrangThai, Converter={StaticResource StatusButtonTextConverter}}"
                                            BackgroundColor="#FFA000"
                                            TextColor="White"
                                            CornerRadius="8"
                                            FontAttributes="Bold"
                                            Clicked="OnToggleStatusClicked"
                                            Padding="10,0"/>

                                    <Button Text="XÃ³a"
                                            BackgroundColor="#E53935"
                                            TextColor="White"
                                            CornerRadius="8"
                                            FontAttributes="Bold"
                                            Clicked="OnHardDeleteClicked"
                                            Padding="10,0"/>
                                </HorizontalStackLayout>

                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>